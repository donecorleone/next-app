{"version":3,"file":"react-lenis.mjs","sources":["../src/index.jsx"],"sourcesContent":["'use client'\n\nimport { useFrame } from '@studio-freight/hamo'\nimport Lenis from '@studio-freight/lenis'\nimport PropTypes from 'prop-types' // ES6\nimport React, {\n  createContext,\n  forwardRef,\n  useCallback,\n  useContext,\n  useEffect,\n  useImperativeHandle,\n  useRef,\n  useState,\n} from 'react'\nimport { create } from 'zustand'\n\nexport const LenisContext = createContext()\n\nconst useRoot = create(() => ({}))\n\nfunction useCurrentLenis() {\n  const local = useContext(LenisContext)\n  const root = useRoot()\n\n  return local ?? root\n}\n\n/**\n * @param {function=} [callback] Callback to be called on scroll\n * @param {Array=} [deps=[]] Dependencies for callback\n * @param {number=} [priority=0] Priority of callback (lower priority callbacks are called first)\n *\n * @returns Lenis instance\n */\nexport function useLenis(callback, deps = [], priority = 0) {\n  const { lenis, addCallback, removeCallback } = useCurrentLenis()\n\n  useEffect(() => {\n    if (!callback || !addCallback || !removeCallback || !lenis) return\n\n    addCallback(callback, priority)\n    callback(lenis)\n\n    return () => {\n      removeCallback(callback)\n    }\n  }, [lenis, addCallback, removeCallback, priority, ...deps])\n\n  return lenis\n}\n\n/**\n * @param {boolean=} [root] Whether Lenis will be initialized on document.documentElement\n * @param {Object=} [options={}] Lenis options\n * @param {boolean=} [autoRaf=true] Whether to call Lenis.raf automatically on every frame\n * @param {number=} [rafPriority=0] Priority of Lenis.raf call (lower priority callbacks are called first)\n */\nconst ReactLenis = forwardRef(\n  ({ children, root = false, options = {}, autoRaf = true, rafPriority = 0, ...props }, ref) => {\n    const wrapper = useRef()\n    const content = useRef()\n\n    const [lenis, setLenis] = useState()\n\n    const callbacks = useRef([])\n\n    const addCallback = useCallback((callback, priority) => {\n      callbacks.current.push({ callback, priority })\n      callbacks.current.sort((a, b) => a.priority - b.priority)\n    }, [])\n\n    const removeCallback = useCallback((callback) => {\n      callbacks.current = callbacks.current.filter((cb) => cb.callback !== callback)\n    }, [])\n\n    useImperativeHandle(ref, () => lenis, [lenis])\n\n    useEffect(() => {\n      const lenis = new Lenis({\n        ...options,\n        ...(!root && {\n          wrapper: wrapper.current,\n          content: content.current,\n        }),\n      })\n\n      setLenis(lenis)\n\n      return () => {\n        lenis.destroy()\n        setLenis(undefined)\n      }\n    }, [root, JSON.stringify(options)])\n\n    useFrame((time) => {\n      if (autoRaf) {\n        lenis?.raf(time)\n      }\n    }, rafPriority)\n\n    useEffect(() => {\n      if (root && lenis) {\n        useRoot.setState({ lenis, addCallback, removeCallback })\n      }\n    }, [root, lenis, addCallback, removeCallback])\n\n    const onScroll = useCallback((e) => {\n      for (let i = 0; i < callbacks.current.length; i++) {\n        callbacks.current[i].callback(e)\n      }\n    }, [])\n\n    useEffect(() => {\n      if (!lenis) return\n\n      lenis.on('scroll', onScroll)\n\n      return () => {\n        lenis.off('scroll', onScroll)\n      }\n    }, [lenis, onScroll])\n\n    return (\n      <LenisContext.Provider value={{ lenis, addCallback, removeCallback }}>\n        {root ? (\n          children\n        ) : (\n          <div ref={wrapper} {...props}>\n            <div ref={content}>{children}</div>\n          </div>\n        )}\n      </LenisContext.Provider>\n    )\n  },\n)\nReactLenis.displayName = 'ReactLenis'\n\nReactLenis.propTypes = {\n  children: PropTypes.node,\n  root: PropTypes.bool,\n  options: PropTypes.object,\n  autoRaf: PropTypes.bool,\n  rafPriority: PropTypes.number,\n}\n\nexport { ReactLenis, ReactLenis as Lenis }\n"],"names":["_excluded","LenisContext","createContext","useRoot","create","useLenis","callback","deps","priority","local","root","_useCurrentLenis","useContext","lenis","addCallback","removeCallback","useEffect","concat","ReactLenis","forwardRef","_ref","ref","children","_ref$root","_ref$options","options","_ref$autoRaf","autoRaf","_ref$rafPriority","rafPriority","props","_objectWithoutPropertiesLoose","wrapper","useRef","content","_useState","useState","setLenis","callbacks","useCallback","current","push","sort","a","b","filter","cb","useImperativeHandle","Lenis","_extends","destroy","undefined","JSON","stringify","useFrame","time","raf","setState","onScroll","e","i","length","on","off","React","createElement","Provider","value","displayName","propTypes","PropTypes","node","bool","object","number"],"mappings":"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"}