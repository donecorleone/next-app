{"version":3,"file":"react-lenis.umd.js","sources":["../src/index.jsx"],"sourcesContent":["'use client'\n\nimport { useFrame } from '@studio-freight/hamo'\nimport Lenis from '@studio-freight/lenis'\nimport PropTypes from 'prop-types' // ES6\nimport React, {\n  createContext,\n  forwardRef,\n  useCallback,\n  useContext,\n  useEffect,\n  useImperativeHandle,\n  useRef,\n  useState,\n} from 'react'\nimport { create } from 'zustand'\n\nexport const LenisContext = createContext()\n\nconst useRoot = create(() => ({}))\n\nfunction useCurrentLenis() {\n  const local = useContext(LenisContext)\n  const root = useRoot()\n\n  return local ?? root\n}\n\n/**\n * @param {function=} [callback] Callback to be called on scroll\n * @param {Array=} [deps=[]] Dependencies for callback\n * @param {number=} [priority=0] Priority of callback (lower priority callbacks are called first)\n *\n * @returns Lenis instance\n */\nexport function useLenis(callback, deps = [], priority = 0) {\n  const { lenis, addCallback, removeCallback } = useCurrentLenis()\n\n  useEffect(() => {\n    if (!callback || !addCallback || !removeCallback || !lenis) return\n\n    addCallback(callback, priority)\n    callback(lenis)\n\n    return () => {\n      removeCallback(callback)\n    }\n  }, [lenis, addCallback, removeCallback, priority, ...deps])\n\n  return lenis\n}\n\n/**\n * @param {boolean=} [root] Whether Lenis will be initialized on document.documentElement\n * @param {Object=} [options={}] Lenis options\n * @param {boolean=} [autoRaf=true] Whether to call Lenis.raf automatically on every frame\n * @param {number=} [rafPriority=0] Priority of Lenis.raf call (lower priority callbacks are called first)\n */\nconst ReactLenis = forwardRef(\n  ({ children, root = false, options = {}, autoRaf = true, rafPriority = 0, ...props }, ref) => {\n    const wrapper = useRef()\n    const content = useRef()\n\n    const [lenis, setLenis] = useState()\n\n    const callbacks = useRef([])\n\n    const addCallback = useCallback((callback, priority) => {\n      callbacks.current.push({ callback, priority })\n      callbacks.current.sort((a, b) => a.priority - b.priority)\n    }, [])\n\n    const removeCallback = useCallback((callback) => {\n      callbacks.current = callbacks.current.filter((cb) => cb.callback !== callback)\n    }, [])\n\n    useImperativeHandle(ref, () => lenis, [lenis])\n\n    useEffect(() => {\n      const lenis = new Lenis({\n        ...options,\n        ...(!root && {\n          wrapper: wrapper.current,\n          content: content.current,\n        }),\n      })\n\n      setLenis(lenis)\n\n      return () => {\n        lenis.destroy()\n        setLenis(undefined)\n      }\n    }, [root, JSON.stringify(options)])\n\n    useFrame((time) => {\n      if (autoRaf) {\n        lenis?.raf(time)\n      }\n    }, rafPriority)\n\n    useEffect(() => {\n      if (root && lenis) {\n        useRoot.setState({ lenis, addCallback, removeCallback })\n      }\n    }, [root, lenis, addCallback, removeCallback])\n\n    const onScroll = useCallback((e) => {\n      for (let i = 0; i < callbacks.current.length; i++) {\n        callbacks.current[i].callback(e)\n      }\n    }, [])\n\n    useEffect(() => {\n      if (!lenis) return\n\n      lenis.on('scroll', onScroll)\n\n      return () => {\n        lenis.off('scroll', onScroll)\n      }\n    }, [lenis, onScroll])\n\n    return (\n      <LenisContext.Provider value={{ lenis, addCallback, removeCallback }}>\n        {root ? (\n          children\n        ) : (\n          <div ref={wrapper} {...props}>\n            <div ref={content}>{children}</div>\n          </div>\n        )}\n      </LenisContext.Provider>\n    )\n  },\n)\nReactLenis.displayName = 'ReactLenis'\n\nReactLenis.propTypes = {\n  children: PropTypes.node,\n  root: PropTypes.bool,\n  options: PropTypes.object,\n  autoRaf: PropTypes.bool,\n  rafPriority: PropTypes.number,\n}\n\nexport { ReactLenis, ReactLenis as Lenis }\n"],"names":["_excluded","LenisContext","createContext","useRoot","create","ReactLenis","forwardRef","_ref","ref","children","_ref$root","root","_ref$options","options","_ref$autoRaf","autoRaf","_ref$rafPriority","rafPriority","props","_objectWithoutPropertiesLoose","wrapper","useRef","content","_useState","useState","lenis","setLenis","callbacks","addCallback","useCallback","callback","priority","current","push","sort","a","b","removeCallback","filter","cb","useImperativeHandle","useEffect","Lenis","_extends","destroy","undefined","JSON","stringify","useFrame","time","raf","setState","onScroll","e","i","length","on","off","React","createElement","Provider","value","displayName","propTypes","PropTypes","node","bool","object","number","deps","local","_useCurrentLenis","useContext","concat"],"mappings":"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"}